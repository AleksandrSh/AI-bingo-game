
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Acumen Bingo &ndash; EMEA J&amp;C AI in Action</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Mono:wght@300;400;500&display=swap');

  :root {
    --cisco-blue: #049fd9;
    --cisco-teal: #00bceb;
    --gold: #f5c842;
    --neon: #39ff90;
    --bg: #020e16;
    --card-bg: #071a24;
    --card-border: #0e3347;
    --text: #e8f4fa;
    --muted: #5a8fa8;
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'DM Mono', monospace;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed; inset: 0;
    background-image:
      linear-gradient(rgba(4,159,217,0.04) 1px, transparent 1px),
      linear-gradient(90deg, rgba(4,159,217,0.04) 1px, transparent 1px);
    background-size: 40px 40px;
    z-index: 0; pointer-events: none;
  }

  .container {
    position: relative; z-index: 1;
    max-width: 1100px; margin: 0 auto; padding: 20px;
  }

  /* â”€â”€ Header â”€â”€ */
  header { text-align: center; padding: 40px 0 28px; }

  .header-badge {
    display: inline-block;
    background: linear-gradient(90deg, var(--cisco-blue), var(--cisco-teal));
    color: #fff; font-family: 'Syne', sans-serif;
    font-size: 0.68rem; font-weight: 700;
    letter-spacing: 0.25em; text-transform: uppercase;
    padding: 5px 16px; border-radius: 20px; margin-bottom: 14px;
    animation: pulse-badge 3s ease-in-out infinite;
  }

  @keyframes pulse-badge {
    0%,100% { box-shadow: 0 0 0 0 rgba(4,159,217,0.4); }
    50%      { box-shadow: 0 0 0 10px rgba(4,159,217,0); }
  }

  header h1 {
    font-family: 'Syne', sans-serif;
    font-size: clamp(2.2rem, 6vw, 4rem); font-weight: 800;
    line-height: 1; letter-spacing: -0.02em;
    background: linear-gradient(135deg, #fff 0%, var(--cisco-teal) 50%, var(--gold) 100%);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
    margin-bottom: 8px;
  }

  header p.sub {
    font-size: 0.82rem; color: var(--muted);
    letter-spacing: 0.1em; text-transform: uppercase;
  }

  /* â”€â”€ Instructions â”€â”€ */
  .instructions {
    background: var(--card-bg); border: 1px solid var(--card-border);
    border-radius: 16px; padding: 20px 24px; margin: 22px 0;
    font-size: 0.76rem; line-height: 1.8; color: var(--muted);
  }

  .instructions h4 {
    font-family: 'Syne', sans-serif; font-size: 0.76rem; font-weight: 700;
    color: var(--cisco-teal); letter-spacing: 0.15em; text-transform: uppercase; margin-bottom: 8px;
  }

  .instructions ol { padding-left: 16px; }
  .instructions li { margin-bottom: 4px; }
  .instructions li span { color: var(--text); }

  /* â”€â”€ Team Setup Panel â”€â”€ */
  .setup-panel {
    background: var(--card-bg);
    border: 1px solid rgba(4,159,217,0.3);
    border-radius: 20px;
    padding: 24px;
    margin-bottom: 22px;
  }

  .setup-panel-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 18px;
    flex-wrap: wrap;
    gap: 10px;
  }

  .setup-panel-title {
    font-family: 'Syne', sans-serif;
    font-size: 0.72rem; font-weight: 700;
    letter-spacing: 0.18em; text-transform: uppercase;
    color: var(--cisco-teal);
  }

  .add-team-btn {
    font-family: 'Syne', sans-serif; font-size: 0.7rem; font-weight: 700;
    letter-spacing: 0.1em; text-transform: uppercase;
    padding: 8px 16px; border-radius: 8px;
    border: 1.5px solid rgba(4,159,217,0.4);
    background: rgba(4,159,217,0.08); color: var(--cisco-teal);
    cursor: pointer; transition: all 0.18s;
  }

  .add-team-btn:hover { background: rgba(4,159,217,0.18); transform: translateY(-1px); }
  .add-team-btn:disabled { opacity: 0.35; cursor: not-allowed; transform: none; }

  .team-inputs-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 10px;
  }

  .team-input-row {
    display: flex;
    align-items: center;
    gap: 8px;
    background: rgba(255,255,255,0.03);
    border: 1px solid var(--card-border);
    border-radius: 10px;
    padding: 10px 12px;
    transition: border-color 0.2s;
  }

  .team-input-row:focus-within { border-color: var(--cisco-blue); }

  .team-color-dot {
    width: 10px; height: 10px;
    border-radius: 50%;
    flex-shrink: 0;
  }

  .team-name-field {
    flex: 1;
    background: transparent; border: none;
    font-family: 'Syne', sans-serif; font-size: 0.82rem; font-weight: 700;
    color: var(--text); outline: none;
    min-width: 0;
  }

  .team-name-field::placeholder { color: var(--muted); font-weight: 400; font-size: 0.75rem; }

  .remove-team-btn {
    background: transparent; border: none;
    color: var(--muted); cursor: pointer;
    font-size: 0.85rem; padding: 2px 4px;
    border-radius: 4px; transition: color 0.15s;
    flex-shrink: 0;
  }

  .remove-team-btn:hover { color: #ff5aac; }

  /* â”€â”€ Active Team Switcher â”€â”€ */
  .active-team-wrap {
    display: flex;
    align-items: center;
    gap: 10px;
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: 14px;
    padding: 12px 18px;
    margin-bottom: 22px;
    flex-wrap: wrap;
  }

  .active-team-label {
    font-family: 'Syne', sans-serif;
    font-size: 0.65rem; font-weight: 700;
    letter-spacing: 0.14em; text-transform: uppercase;
    color: var(--muted); white-space: nowrap;
  }

  .team-tabs { display: flex; gap: 7px; flex-wrap: wrap; flex: 1; }

  .team-tab {
    font-family: 'Syne', sans-serif; font-size: 0.72rem; font-weight: 700;
    padding: 6px 14px; border-radius: 7px;
    border: 1.5px solid transparent;
    cursor: pointer; transition: all 0.18s;
    background: rgba(255,255,255,0.04);
    color: var(--muted);
    white-space: nowrap;
  }

  .team-tab.active-tab { transform: scale(1.06); }
  .team-tab.rename-btn { padding: 6px 8px; font-size: 0.82rem; background: rgba(255,255,255,0.04); border: none; }

  /* â”€â”€ Score Strip â”€â”€ */
  .score-strip {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 28px;
    background: var(--card-bg);
    border: 1px solid rgba(4,159,217,0.3);
    border-radius: 16px;
    padding: 20px 32px;
    margin-bottom: 22px;
    flex-wrap: wrap;
  }

  .score-block { text-align: center; }

  .score-block .label {
    font-family: 'Syne', sans-serif; font-size: 0.62rem; font-weight: 700;
    letter-spacing: 0.16em; text-transform: uppercase;
    color: var(--muted); margin-bottom: 4px;
  }

  .score-block .value {
    font-family: 'Syne', sans-serif; font-size: 2.4rem; font-weight: 800;
    color: var(--cisco-teal); line-height: 1;
  }

  .score-block .sub-value { font-size: 0.6rem; color: var(--muted); margin-top: 3px; }

  .score-divider { width: 1px; height: 52px; background: var(--card-border); }

  /* â”€â”€ Progress Bars â”€â”€ */
  .progress-wrap {
    background: var(--card-bg); border: 1px solid var(--card-border);
    border-radius: 12px; padding: 14px 20px; margin-bottom: 22px;
  }

  .progress-wrap-title {
    font-family: 'Syne', sans-serif; font-size: 0.7rem; font-weight: 700;
    color: var(--muted); letter-spacing: 0.12em; text-transform: uppercase;
    margin-bottom: 12px;
  }

  .progress-team-row {
    margin-bottom: 10px;
  }
  .progress-team-row:last-child { margin-bottom: 0; }

  .progress-bingo-badge {
    display: inline-flex; align-items: center; gap: 3px;
    background: rgba(255, 215, 0, 0.15); color: #ffd700;
    font-size: 0.6rem; font-weight: 800; letter-spacing: 0.06em;
    padding: 1px 7px; border-radius: 6px; margin-left: 6px;
  }

  .progress-place-badge {
    display: inline-flex; align-items: center;
    font-size: 0.58rem; font-weight: 800; letter-spacing: 0.04em;
    padding: 1px 7px; border-radius: 6px; margin-left: 4px;
  }
  .place-1st { background: rgba(255, 215, 0, 0.18); color: #ffd700; }
  .place-2nd { background: rgba(192, 192, 192, 0.18); color: #c0c0c0; }
  .place-3rd { background: rgba(205, 127, 50, 0.18); color: #cd7f32; }
  .place-other { background: rgba(255, 255, 255, 0.08); color: var(--muted); }

  .progress-label {
    font-family: 'Syne', sans-serif; font-size: 0.62rem; font-weight: 700;
    color: var(--muted); letter-spacing: 0.10em; text-transform: uppercase;
    margin-bottom: 4px; display: flex; justify-content: space-between; align-items: center;
  }

  .progress-team-name {
    display: flex; align-items: center; gap: 6px;
  }

  .progress-color-dot {
    width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0;
  }

  .progress-bar-bg {
    background: rgba(255,255,255,0.05);
    border-radius: 8px; height: 10px; overflow: hidden;
  }

  .progress-bar-fill {
    height: 100%; border-radius: 8px;
    transition: width 0.4s ease; width: 0%;
  }

  /* â”€â”€ Board â”€â”€ */
  .board-wrap {
    background: var(--card-bg); border: 1px solid var(--card-border);
    border-radius: 20px; padding: 20px; margin-bottom: 22px;
    box-shadow: 0 0 60px rgba(4,159,217,0.07);
  }

  .bingo-header-row {
    display: grid; grid-template-columns: repeat(5, 1fr);
    gap: 8px; margin-bottom: 8px;
  }

  .bingo-letter {
    font-family: 'Syne', sans-serif; font-size: 1.5rem; font-weight: 800;
    text-align: center; padding: 4px 0; letter-spacing: 0.05em;
  }

  .bingo-letter:nth-child(1) { color: #ff5aac; }
  .bingo-letter:nth-child(2) { color: var(--cisco-teal); }
  .bingo-letter:nth-child(3) { color: var(--neon); }
  .bingo-letter:nth-child(4) { color: var(--gold); }
  .bingo-letter:nth-child(5) { color: var(--cisco-blue); }

  .bingo-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; }

  .cell {
    background: rgba(255,255,255,0.03);
    border: 1px solid var(--card-border);
    border-radius: 12px; padding: 12px 8px; min-height: 110px;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    text-align: center; font-size: 0.61rem; line-height: 1.45;
    cursor: pointer; transition: all 0.22s ease;
    position: relative; overflow: hidden; color: var(--text); user-select: none;
  }

  .cell:hover:not(.free-space):not(.view-only) {
    border-color: var(--cisco-blue);
    background: rgba(4,159,217,0.08); transform: scale(1.02);
  }

  .cell .num {
    font-family: 'Syne', sans-serif; font-size: 0.56rem; font-weight: 700;
    color: var(--muted); margin-bottom: 5px; letter-spacing: 0.08em;
  }

  .cell.free-space {
    background: linear-gradient(135deg, var(--cisco-blue), var(--cisco-teal));
    border-color: var(--cisco-teal); color: #fff; cursor: default;
  }

  .cell.marked {
    background: linear-gradient(135deg, rgba(4,159,217,0.30), rgba(0,188,235,0.12));
    border-color: var(--cisco-teal); color: #fff;
  }

  .cell.marked .num { color: rgba(255,255,255,0.5); }

  .check-mark {
    position: absolute; top: 5px; right: 7px;
    font-size: 0.82rem; font-weight: bold;
  }

  /* Multi-team dot indicators on cells */
  .cell-team-dots {
    position: absolute; bottom: 4px; left: 0; right: 0;
    display: flex; justify-content: center; gap: 3px; flex-wrap: wrap; padding: 0 4px;
  }

  .cell-dot {
    width: 6px; height: 6px; border-radius: 50%;
    flex-shrink: 0;
  }

  .cell.bingo-line { animation: flash-bingo 0.55s ease-in-out 4; }

  @keyframes flash-bingo {
    0%,100% { filter: brightness(1); }
    50%      { filter: brightness(2.2); }
  }

  /* â”€â”€ Controls â”€â”€ */
  .controls {
    display: flex; gap: 12px; justify-content: center;
    margin-bottom: 26px; flex-wrap: wrap;
  }

  .ctrl-btn {
    font-family: 'Syne', sans-serif; font-weight: 700; font-size: 0.76rem;
    letter-spacing: 0.08em; text-transform: uppercase;
    padding: 11px 24px; border-radius: 10px; border: none;
    cursor: pointer; transition: all 0.18s;
  }

  .ctrl-btn.primary {
    background: linear-gradient(135deg, var(--cisco-blue), var(--cisco-teal)); color: #fff;
  }

  .ctrl-btn.secondary {
    background: transparent; border: 1.5px solid var(--card-border); color: var(--muted);
  }

  .ctrl-btn:hover { transform: translateY(-2px); filter: brightness(1.12); }

  /* â”€â”€ Winner Modal â”€â”€ */
  .modal-overlay {
    display: none; position: fixed; inset: 0;
    background: rgba(2,14,22,0.93); z-index: 100;
    align-items: center; justify-content: center; padding: 20px;
  }

  .modal-overlay.show { display: flex; }

  .modal {
    background: var(--card-bg); border: 1px solid var(--cisco-blue);
    border-radius: 24px; padding: 48px 40px; text-align: center;
    max-width: 560px; width: 100%; position: relative;
    box-shadow: 0 0 80px rgba(4,159,217,0.3);
    animation: modal-in 0.4s cubic-bezier(0.34,1.56,0.64,1);
  }

  @keyframes modal-in {
    from { opacity: 0; transform: scale(0.85) translateY(28px); }
    to   { opacity: 1; transform: scale(1) translateY(0); }
  }

  .trophy-icon {
    font-size: 4.2rem; margin-bottom: 14px; display: block;
    animation: trophy-bounce 0.65s ease-in-out infinite alternate;
  }

  @keyframes trophy-bounce {
    from { transform: translateY(0) rotate(-5deg); }
    to   { transform: translateY(-8px) rotate(5deg); }
  }

  .modal h2 {
    font-family: 'Syne', sans-serif; font-size: 1.8rem; font-weight: 800; margin-bottom: 6px;
    background: linear-gradient(135deg, var(--gold), #fff, var(--cisco-teal));
    -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
  }

  .cert-winner-name {
    font-family: 'Syne', sans-serif; font-size: 2rem; font-weight: 800;
    margin-bottom: 6px; color: var(--gold);
  }

  .certificate {
    background: linear-gradient(135deg, rgba(245,200,66,0.1), rgba(4,159,217,0.1));
    border: 2px solid var(--gold); border-radius: 16px;
    padding: 24px; margin: 20px 0; position: relative;
  }

  .cert-title   { font-family: 'Syne', sans-serif; font-size: 0.62rem; letter-spacing: 0.24em; text-transform: uppercase; color: var(--gold); margin-bottom: 7px; }
  .cert-main    { font-family: 'Syne', sans-serif; font-size: 1.3rem; font-weight: 800; color: #fff; margin-bottom: 5px; }
  .cert-sub     { font-size: 0.7rem; color: var(--muted); }
  .cert-awarded { font-size: 0.66rem; color: var(--cisco-teal); margin-top: 10px; font-weight: 500; }

  .modal-close {
    position: absolute; top: 14px; right: 14px;
    background: transparent; border: none; color: var(--muted);
    font-size: 1.2rem; cursor: pointer; padding: 4px 8px;
  }
  .modal-close:hover { color: var(--text); }

  /* â”€â”€ Reflection â”€â”€ */
  .reflection-section {
    background: var(--card-bg); border: 1px solid var(--card-border);
    border-radius: 20px; padding: 34px; margin-bottom: 28px; display: none;
  }

  .reflection-section.show { display: block; }

  .reflection-section h3 {
    font-family: 'Syne', sans-serif; font-size: 1.05rem; font-weight: 800; margin-bottom: 4px;
    background: linear-gradient(90deg, var(--cisco-teal), var(--neon));
    -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
  }

  .reflection-prompt {
    background: rgba(57,255,144,0.07); border: 1px solid rgba(57,255,144,0.2);
    border-radius: 12px; padding: 20px 22px; margin: 16px 0;
    font-size: 1rem; line-height: 1.6; color: var(--text); font-style: italic;
  }

  .reflection-note { font-size: 0.75rem; color: var(--muted); line-height: 1.65; }

  /* â”€â”€ Confetti â”€â”€ */
  .confetti-piece {
    position: fixed; top: -10px; border-radius: 2px;
    animation: confetti-fall linear forwards;
    z-index: 200; pointer-events: none;
  }

  @keyframes confetti-fall {
    to { transform: translateY(110vh) rotate(720deg); opacity: 0; }
  }

  /* â”€â”€ Team name entry overlay â”€â”€ */
  .name-entry-overlay {
    position: fixed; inset: 0;
    background: rgba(2,14,22,0.97);
    z-index: 50;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
  }
  .name-entry-overlay.hidden { display: none; }
  .name-entry-box {
    background: var(--card-bg);
    border: 1px solid var(--cisco-blue);
    border-radius: 20px;
    padding: 32px 40px;
    max-width: 400px;
    width: 100%;
    text-align: center;
  }
  .name-entry-box h3 {
    font-family: 'Syne', sans-serif;
    font-size: 1.1rem;
    color: var(--cisco-teal);
    margin-bottom: 16px;
    letter-spacing: 0.08em;
  }
  .name-entry-box input {
    width: 100%;
    padding: 12px 16px;
    border: 1px solid var(--card-border);
    border-radius: 10px;
    background: rgba(255,255,255,0.05);
    color: var(--text);
    font-family: 'Syne', sans-serif;
    font-size: 1rem;
    margin-bottom: 16px;
  }
  .name-entry-box input:focus {
    outline: none;
    border-color: var(--cisco-blue);
  }
  .name-entry-box input::placeholder { color: var(--muted); }
  .team-row-owner { font-size: 0.7rem; color: var(--muted); margin-left: 4px; }
  .cell.view-only { cursor: default; }

  @media (max-width: 600px) {
    .cell { min-height: 80px; font-size: 0.52rem; padding: 7px 4px; }
    .bingo-letter { font-size: 1.1rem; }
    .modal { padding: 28px 18px; }
    .score-strip { gap: 16px; padding: 16px; }
    .team-inputs-grid { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>
<!-- Team name entry overlay -->
<div class="name-entry-overlay" id="name-entry-overlay">
  <div class="name-entry-box">
    <h3 id="overlay-title">Name your team</h3>
    <p id="overlay-subtitle" style="font-size:0.78rem;color:var(--muted);margin-bottom:12px;">Choose a team name. You control your team's board and everyone can see your progress.</p>
    <input type="text" id="team-name-input" maxlength="30" placeholder="Team name..." autocomplete="off" />
    <button class="ctrl-btn primary" id="join-game-btn" type="button">Join game</button>
  </div>
</div>

<div class="container">

  <header>
    <div class="header-badge">ğŸ¤– EMEA J&amp;C &middot; AI in Action</div>
    <h1>AI ACUMEN<br>BINGO</h1>
    <p class="sub">Recruiting Team &middot; Challenge Edition</p>
    <p class="sub" id="room-code" style="margin-top:10px;display:none">
      Room: <span id="room-code-value" style="color:var(--cisco-teal);font-weight:700"></span>
      <button
        class="add-team-btn"
        id="copy-link-btn"
        onclick="copyGameLink()"
        style="margin-left:10px;padding:6px 12px"
        title="Copy the share link"
      >Copy link</button>
    </p>
  </header>

  <div class="instructions">
    <h4>ğŸ® How to Play</h4>
    <ol>
      <li><span>Name your team</span> when you join. You can rename it any time in the Teams section.</li>
      <li><span>Click squares</span> on your team's board when you complete a challenge. Other teams are view-only.</li>
      <li><span>Switch tabs</span> in "Playing as" to see other teams' progress in real time.</li>
      <li><span>First team to get 5 in a row</span> (horizontal, vertical, or diagonal) wins BINGO! ğŸ‰</li>
      <li><span>At the end</span>, hit "Reflection Round" and everyone shares one new thing they learned.</li>
    </ol>
  </div>

  <!-- Team Setup -->
  <div class="setup-panel">
    <div class="setup-panel-header">
      <span class="setup-panel-title">ğŸ‘¥ Teams</span>
    </div>
    <div class="team-inputs-grid" id="team-inputs-grid"></div>
  </div>

  <!-- Active Team Switcher -->
  <div class="active-team-wrap" id="active-team-wrap" style="display:none">
    <span class="active-team-label">Playing as &rarr;</span>
    <div class="team-tabs" id="team-tabs"></div>
  </div>

  <!-- Score Strip -->
  <div class="score-strip">
    <div class="score-block">
      <div class="label">Best Line</div>
      <div class="value" id="squares-count">0</div>
      <div class="sub-value">of 5 to BINGO</div>
    </div>
    <div class="score-divider"></div>
    <div class="score-block">
      <div class="label">BINGOs</div>
      <div class="value" id="bingo-count">0</div>
      <div class="sub-value">lines completed</div>
    </div>
    <div class="score-divider"></div>
    <div class="score-block">
      <div class="label">Status</div>
      <div class="value" id="status-emoji" style="font-size:2rem">ğŸ¯</div>
      <div class="sub-value" id="status-text">Let's go!</div>
    </div>
  </div>

  <!-- Progress Bars (all teams) -->
  <div class="progress-wrap">
    <div class="progress-wrap-title">Progress to BINGO</div>
    <div id="all-progress-bars"></div>
  </div>

  <!-- Board -->
  <div class="board-wrap">
    <div class="bingo-header-row">
      <div class="bingo-letter">B</div>
      <div class="bingo-letter">I</div>
      <div class="bingo-letter">N</div>
      <div class="bingo-letter">G</div>
      <div class="bingo-letter">O</div>
    </div>
    <div class="bingo-grid" id="bingo-grid"></div>
  </div>

  <!-- Controls -->
  <div class="controls">
    <button class="ctrl-btn primary" onclick="showReflection()">ğŸ¤ Reflection Round</button>
  </div>

  <!-- Reflection -->
  <div class="reflection-section" id="reflection-section">
    <h3>ğŸ’¡ Reflection Round</h3>
    <p style="font-size:0.78rem;color:var(--muted);margin-bottom:2px;">Go around the room and ask everyone:</p>
    <div class="reflection-prompt">
      What is ONE thing you didn't know before today that you learned from this AI Acumen Bingo game?
    </div>
    <p class="reflection-note">
      âœ¨ There are no wrong answers! A new tool, a prompt tip, a LinkedIn voice to follow, a newsletter to subscribe to,
      or an internal Cisco resource you didn't know existed &mdash; every insight counts. Share it and inspire your teammates!
    </p>
    <br>
    <p class="reflection-note" style="color:var(--cisco-teal);">
      ğŸš€ The <strong>EMEA J&amp;C AI in Action</strong> team thanks you for playing. Now go put that AI acumen to work!
    </p>
  </div>

</div>

<!-- Winner Modal -->
<div class="modal-overlay" id="winner-modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal()">&#x2715;</button>
    <span class="trophy-icon">ğŸ†</span>
    <h2>BINGO!</h2>
    <div class="cert-winner-name" id="cert-winner-name"></div>
    <div id="cert-place-line" style="font-size:1rem;font-weight:700;margin-bottom:4px;"></div>
    <div class="certificate">
      <div class="cert-title">Certificate of Achievement</div>
      <div class="cert-main" id="cert-main-line">ğŸ¥‡ Best AI Acumen</div>
      <div class="cert-sub">Awarded for excellence in AI knowledge, curiosity &amp; speed</div>
      <div class="cert-awarded">Presented by the <strong>EMEA J&amp;C AI in Action Team</strong></div>
    </div>
    <p style="font-size:0.78rem;color:var(--muted);line-height:1.6;">
      ğŸ‰ Congratulations! You demonstrated exceptional AI acumen.<br>Keep exploring, keep learning, keep growing!
    </p>
    <button class="ctrl-btn primary" style="margin-top:18px" onclick="closeModal()">Keep Playing</button>
  </div>
</div>

<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js';
import {
  getFirestore,
  doc,
  collection,
  getDoc,
  setDoc,
  addDoc,
  updateDoc,
  deleteDoc,
  onSnapshot,
  runTransaction,
  writeBatch
} from 'https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js';

const firebaseConfig = {
  apiKey: "AIzaSyCWyRvUE6iY4bnc9v-1wZTArlfVq-IuyrY",
  authDomain: "bingo-game-880a0.firebaseapp.com",
  projectId: "bingo-game-880a0",
  storageBucket: "bingo-game-880a0.firebasestorage.app",
  messagingSenderId: "785624250145",
  appId: "1:785624250145:web:53c4d0dcd17655d7873060",
  measurementId: "G-3T2WG2Q1XN"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// â”€â”€ Palette â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const PALETTE = [
  '#049fd9','#ff5aac','#39ff90','#f5c842','#bf7fff',
  '#ff8c42','#00e8c6','#ff4545','#b0ff57','#ffc2f5','#4da6ff'
];

const FREE_INDEX = 12;

const challenges = [
  "Share an AI post made by Jeetu Patel on LinkedIn recently",
  "Register and share an AI course on Edge up Skills Studio",
  "Create and share a lego picture of your favourite Cisco executive using Nano Banana (Gemini)",
  "Find and share \"Prompt With Purpose: Prompt Library\" shared by P&C x AI",
  "Share a recent news from \"Superhuman AI\" newsletter",
  "Find and share an AI podcast",
  "Find \"AI Agents Explained: A Comprehensive Guide for Beginners\" training on Edge Up internal page",
  "Share an AI post made by Allie K. Miller on LinkedIn recently",
  "Find and share \"Prompt With Purpose: Prompt Library\" shared by P&C x AI",
  "Share a recent news from \"The Neuron\" newsletter",
  "Find an internal Cisco page on how to \"Build Your First AI Agent in Under 30 Minutes\"",
  "Suggest a use case for a potential agent on Circuit",
  "FREE SPACE",
  "Share a recent news from \"The Rundown AI\" newsletter",
  "Share an AI post made by Glen Cathey on LinkedIn recently",
  "Copy and paste the \"Team Space Check-In prompt\" from Circuit",
  "Find an internal Cisco page on how to \"Build Your First AI Agent in Under 30 Minutes\"",
  "Create and share a lego picture of a Cisco product using Nano Banana (Gemini)",
  "Join an AI Cisco internal community - share which one you chose",
  "Find and share \"Prompt With Purpose: Getting Started Guide\" shared by P&C x AI",
  "Share a recent LinkedIn post from Aruna Ravichandran",
  "Copy and paste the \"Prompt to create a prompt\" from Circuit",
  "Create and share a birthday card using Circuit Image Generator",
  "Share a refined prompt using Cisco's \"Teaming with AI: Prompt Coach\"",
  "Find and share Cisco's AI Tools Dashboard"
];

const statusStages = [
  { min:0,  max:0,  emoji:'ğŸ¯', text:"Let's go!" },
  { min:1,  max:1,  emoji:'ğŸ”¥', text:"Warming up!" },
  { min:2,  max:2,  emoji:'âš¡', text:"On a roll!" },
  { min:3,  max:3,  emoji:'ğŸš€', text:"Getting close!" },
  { min:4,  max:4,  emoji:'ğŸŒŸ', text:"Almost there!" },
  { min:5,  max:5,  emoji:'ğŸ†', text:"BINGO!" },
];

// â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let teams = [];
let activeTeamId = null;
let totalBingos = 0;

// â”€â”€ Player identity (invisible ID only; no "user name") â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const STORAGE_KEY_ID = 'bingo_player_id';
const STORAGE_KEY_TEAM_NAME = 'bingo_initial_team_name';

function getPlayerId() {
  return localStorage.getItem(STORAGE_KEY_ID) || '';
}

function setPlayerId(id) {
  localStorage.setItem(STORAGE_KEY_ID, id);
}

function getInitialTeamName() {
  return (localStorage.getItem(STORAGE_KEY_TEAM_NAME) || '').trim();
}

function setInitialTeamName(name) {
  localStorage.setItem(STORAGE_KEY_TEAM_NAME, (name || '').trim());
}

function generateUuid() {
  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {
    const r = (Math.random() * 16) | 0;
    const v = c === 'x' ? r : (r & 0x3) | 0x8;
    return v.toString(16);
  });
}

function getMyTeamId() {
  const pid = getPlayerId();
  const t = teams.find(t => t.ownerId === pid);
  return t ? t.id : null;
}

function isMyTeam(team) {
  return team && team.ownerId === getPlayerId();
}

// â”€â”€ Multiplayer (Firestore) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let gameId = null;
let unsubTeams = null;
const lastBingoAtByTeam = new Map();
const clientStartedAt = Date.now();
let ensuringDefaultTeam = false;

function generateGameId() {
  const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
  let out = '';
  for (let i = 0; i < 6; i++) out += chars[Math.floor(Math.random() * chars.length)];
  return out;
}

function getGameIdFromUrl() {
  const params = new URLSearchParams(window.location.search);
  const raw = (params.get('game') || '').trim().toUpperCase();
  return raw || null;
}

function setGameIdInUrl(id) {
  const url = new URL(window.location.href);
  url.searchParams.set('game', id);
  window.history.replaceState(null, '', url.toString());
}

function getRefs(id) {
  const gameRef = doc(db, 'games', id);
  const teamsRef = collection(gameRef, 'teams');
  return { gameRef, teamsRef };
}

function showRoomUI(id) {
  const wrap = document.getElementById('room-code');
  const value = document.getElementById('room-code-value');
  if (!wrap || !value) return;
  value.textContent = id;
  wrap.style.display = 'block';
}

// â”€â”€ Team management â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function addTeam(teamName) {
  if (!gameId) return;
  if (teams.length >= PALETTE.length) return;
  const pid = getPlayerId();
  if (!pid) return;
  const { teamsRef } = getRefs(gameId);

  const color = PALETTE[teams.length];
  const docRef = await addDoc(teamsRef, {
    name: (teamName || '').trim(),
    color,
    ownerId: pid,
    marked: [FREE_INDEX],
    bingos: 0,
    claimedLines: [],
    lastBingoAt: 0,
    lastBingoKey: '',
    firstBingoAt: 0,
    createdAt: Date.now()
  });

  activeTeamId = docRef.id;
}

async function removeTeam(id) {
  if (teams.length <= 1) return;
  if (!gameId) return;
  const team = teams.find(t => t.id === id);
  if (!team || !isMyTeam(team)) return;
  const { teamsRef } = getRefs(gameId);
  await deleteDoc(doc(teamsRef, id));
}

async function setTeamName(id, val) {
  if (!gameId) return;
  const team = teams.find(t => t.id === id);
  if (!team || !isMyTeam(team)) return;
  const { teamsRef } = getRefs(gameId);
  await updateDoc(doc(teamsRef, id), { name: val.trim() });
}

function getTeamLabel(t) {
  const name = (t.name || '').trim();
  return name || ('Team ' + (teams.indexOf(t) + 1));
}

// â”€â”€ Render team list â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderTeamInputs() {
  const grid = document.getElementById('team-inputs-grid');
  grid.innerHTML = '';
  teams.forEach(t => {
    const row = document.createElement('div');
    row.className = 'team-input-row';
    row.id = 'input-row-' + t.id;
    const idJs = JSON.stringify(t.id);
    const isMine = isMyTeam(t);
    row.innerHTML =
      '<div class="team-color-dot" style="background:' + t.color + '"></div>' +
      '<span class="team-name-field" style="color:' + (isMine ? t.color : 'var(--muted)') + ';">' + escHtml(getTeamLabel(t)) + '</span>' +
      (isMine ? '<span class="team-row-owner">(You)</span>' : '');
    grid.appendChild(row);
  });
}

// â”€â”€ Render team tabs (Playing as) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderTeamTabs() {
  const wrap = document.getElementById('active-team-wrap');
  const tabs = document.getElementById('team-tabs');
  wrap.style.display = teams.length > 0 ? 'flex' : 'none';
  tabs.innerHTML = '';
  var sorted = teams.slice().sort(function(a, b) {
    var aMe = isMyTeam(a) ? 0 : 1;
    var bMe = isMyTeam(b) ? 0 : 1;
    return aMe - bMe;
  });
  sorted.forEach(t => {
    const btn = document.createElement('button');
    btn.className = 'team-tab' + (t.id === activeTeamId ? ' active-tab' : '');
    btn.style.borderColor = t.id === activeTeamId ? t.color : 'transparent';
    btn.style.color = t.color;
    btn.style.background = t.id === activeTeamId ? hexAlpha(t.color, 0.15) : 'rgba(255,255,255,0.04)';
    btn.textContent = getTeamLabel(t) + (isMyTeam(t) ? ' (You)' : '');
    btn.onclick = function() { activeTeamId = t.id; renderTeamTabs(); renderBoard(); updateUI(); };
    tabs.appendChild(btn);
    if (isMyTeam(t)) {
      const rename = document.createElement('button');
      rename.className = 'team-tab rename-btn';
      rename.textContent = 'âœï¸';
      rename.title = 'Rename your team';
      rename.onclick = function(e) { e.stopPropagation(); openRenameOverlay(); };
      tabs.appendChild(rename);
    }
  });
}

// â”€â”€ Build / render board â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderBoard() {
  const grid = document.getElementById('bingo-grid');
  grid.innerHTML = '';
  const activeTeam = teams.find(t => t.id === activeTeamId);
  const canEdit = activeTeamId === getMyTeamId();

  for (let i = 0; i < 25; i++) {
    const cell = document.createElement('div');
    const isFree = (i === FREE_INDEX);
    const isMarkedByActive = activeTeam && activeTeam.marked.has(i);

    cell.id = 'cell-' + i;
    cell.className = 'cell' + (isFree ? ' free-space' : '') + (isMarkedByActive && !isFree ? ' marked' : '');

    if (isMarkedByActive && !isFree && activeTeam) {
      cell.style.background = 'linear-gradient(135deg, ' + hexAlpha(activeTeam.color, 0.3) + ', ' + hexAlpha(activeTeam.color, 0.10) + ')';
      cell.style.borderColor = activeTeam.color;
      const ck = document.createElement('span');
      ck.className = 'check-mark';
      ck.style.color = activeTeam.color;
      ck.textContent = '\u2713';
      cell.appendChild(ck);
    }

    if (isFree) {
      cell.innerHTML =
        '<div style="font-family:\'Syne\',sans-serif;font-weight:800;font-size:0.9rem;letter-spacing:0.05em;">FREE</div>' +
        '<div style="font-size:1.3rem;margin:4px 0">&#11088;</div>' +
        '<div style="font-size:0.6rem;opacity:0.8;letter-spacing:0.1em">SPACE</div>';
    } else {
      const numDiv = document.createElement('div');
      numDiv.className = 'num';
      numDiv.textContent = '#' + (i + 1);
      cell.prepend(numDiv);
      cell.appendChild(document.createTextNode(challenges[i]));
      if (!canEdit) cell.classList.add('view-only');
      cell.onclick = canEdit ? (function(idx) { return function() { toggleCell(idx); }; })(i) : null;
    }

    const markedTeams = teams.filter(t => t.marked.has(i) && !isFree);
    if (markedTeams.length > 0) {
      const dotWrap = document.createElement('div');
      dotWrap.className = 'cell-team-dots';
      markedTeams.forEach(t => {
        const dot = document.createElement('div');
        dot.className = 'cell-dot';
        dot.style.background = t.color;
        dot.title = getTeamLabel(t);
        dotWrap.appendChild(dot);
      });
      cell.appendChild(dotWrap);
    }

    grid.appendChild(cell);
  }
}

// â”€â”€ Toggle cell â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function toggleCell(idx) {
  if (idx === FREE_INDEX || !activeTeamId) return;
  if (activeTeamId !== getMyTeamId()) return;
  if (!gameId) return;

  const { teamsRef } = getRefs(gameId);
  const teamRef = doc(teamsRef, activeTeamId);

  await runTransaction(db, async function(tx) {
    const snap = await tx.get(teamRef);
    if (!snap.exists()) return;

    const data = snap.data() || {};
    const markedArr = Array.isArray(data.marked) ? data.marked : [];
    const markedSet = new Set(markedArr);

    const beforeLines = getCompletedLineKeys(markedSet);

    if (markedSet.has(idx)) markedSet.delete(idx);
    else markedSet.add(idx);

    markedSet.add(FREE_INDEX);

    const afterLines = getCompletedLineKeys(markedSet);
    const newlyCompleted = afterLines.filter(function(k) { return beforeLines.indexOf(k) === -1; });

    const update = {
      marked: Array.from(markedSet),
      claimedLines: afterLines,
      bingos: afterLines.length,
      lastMoveAt: Date.now()
    };

    if (newlyCompleted.length > 0) {
      update.lastBingoAt = Date.now();
      update.lastBingoKey = newlyCompleted[0];
      if (beforeLines.length === 0 && !(data.firstBingoAt > 0)) {
        update.firstBingoAt = Date.now();
      }
    }

    tx.update(teamRef, update);
  });
}

// â”€â”€ Bingo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getLines() {
  const lines = [];
  for (let r = 0; r < 5; r++) lines.push([r*5, r*5+1, r*5+2, r*5+3, r*5+4]);
  for (let c = 0; c < 5; c++) lines.push([c, c+5, c+10, c+15, c+20]);
  lines.push([0,6,12,18,24]);
  lines.push([4,8,12,16,20]);
  return lines;
}

function getCompletedLineKeys(markedSet) {
  const out = [];
  for (const line of getLines()) {
    if (line.every(function(idx) { return markedSet.has(idx); })) out.push(line.join('-'));
  }
  return out;
}

function animateBingoLine(lineKey) {
  const idxs = (lineKey || '').split('-').map(Number).filter(function(n) { return Number.isFinite(n); });
  if (idxs.length !== 5) return;
  idxs.forEach(function(idx) { var el = document.getElementById('cell-' + idx); if (el) el.classList.add('bingo-line'); });
  setTimeout(function() {
    idxs.forEach(function(idx) { var el = document.getElementById('cell-' + idx); if (el) el.classList.remove('bingo-line'); });
  }, 2400);
}

// â”€â”€ Update UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getBestLineProgress(markedSet) {
  var best = 0;
  for (var line of getLines()) {
    var count = line.filter(function(idx) { return markedSet.has(idx); }).length;
    if (count > best) best = count;
  }
  return best;
}

function getOrdinal(n) {
  var s = ['th','st','nd','rd'];
  var v = n % 100;
  return n + (s[(v - 20) % 10] || s[v] || s[0]);
}

function getPlaceClass(place) {
  if (place === 1) return 'place-1st';
  if (place === 2) return 'place-2nd';
  if (place === 3) return 'place-3rd';
  return 'place-other';
}

function renderAllProgressBars() {
  const container = document.getElementById('all-progress-bars');
  container.innerHTML = '';

  var placements = teams
    .filter(function(t) { return t.bingos > 0; })
    .sort(function(a, b) {
      var aTime = a.firstBingoAt || a.lastBingoAt || Infinity;
      var bTime = b.firstBingoAt || b.lastBingoAt || Infinity;
      return aTime - bTime;
    });

  var placeMap = {};
  placements.forEach(function(t, i) { placeMap[t.id] = i + 1; });

  var sorted = teams.slice().sort(function(a, b) {
    var pa = placeMap[a.id] || Infinity;
    var pb = placeMap[b.id] || Infinity;
    if (pa !== pb) return pa - pb;
    return getBestLineProgress(b.marked) - getBestLineProgress(a.marked);
  });

  sorted.forEach(function(t) {
    const best = getBestLineProgress(t.marked);
    const pct = Math.round((best / 5) * 100);
    const label = getTeamLabel(t);
    const youTag = isMyTeam(t.id) ? ' <span style="opacity:0.5">(You)</span>' : '';
    const bingoCount = t.bingos || 0;
    const place = placeMap[t.id];
    const placeBadge = place
      ? '<span class="progress-place-badge ' + getPlaceClass(place) + '">' + getOrdinal(place) + '</span>'
      : '';
    const bingoBadge = bingoCount > 0
      ? '<span class="progress-bingo-badge">&#x1F3C6; BINGO' + (bingoCount > 1 ? ' x' + bingoCount : '') + '</span>'
      : '';
    const row = document.createElement('div');
    row.className = 'progress-team-row';
    row.innerHTML =
      '<div class="progress-label">' +
        '<span class="progress-team-name"><span class="progress-color-dot" style="background:' + t.color + '"></span>' + escHtml(label) + youTag + placeBadge + bingoBadge + '</span>' +
        '<span>' + best + ' / 5</span>' +
      '</div>' +
      '<div class="progress-bar-bg">' +
        '<div class="progress-bar-fill" style="width:' + pct + '%;background:' + t.color + '"></div>' +
      '</div>';
    container.appendChild(row);
  });
}

function updateUI() {
  const activeTeam = teams.find(function(t) { return t.id === activeTeamId; });
  const bestLine = activeTeam ? getBestLineProgress(activeTeam.marked) : 0;

  document.getElementById('squares-count').textContent = bestLine;
  document.getElementById('bingo-count').textContent = totalBingos;

  const stage = statusStages.find(function(s) { return bestLine >= s.min && bestLine <= s.max; }) || statusStages[statusStages.length - 1];
  document.getElementById('status-emoji').textContent = stage.emoji;
  document.getElementById('status-text').textContent = stage.text;

  renderAllProgressBars();
}

// â”€â”€ Winner modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showWinner(team) {
  launchConfetti(team.color);
  const label = getTeamLabel(team);
  document.getElementById('cert-winner-name').textContent = label;
  document.getElementById('cert-winner-name').style.color = team.color;

  var finished = teams
    .filter(function(t) { return t.bingos > 0; })
    .sort(function(a, b) {
      var aT = a.firstBingoAt || a.lastBingoAt || Infinity;
      var bT = b.firstBingoAt || b.lastBingoAt || Infinity;
      return aT - bT;
    });
  var place = finished.findIndex(function(t) { return t.id === team.id; }) + 1;
  var placeEmojis = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'];
  var placeEmoji = placeEmojis[place - 1] || 'ğŸ…';
  var placeText = place > 0 ? placeEmoji + ' ' + getOrdinal(place) + ' Place!' : '';

  document.getElementById('cert-place-line').textContent = placeText;
  document.getElementById('cert-place-line').style.color = place === 1 ? '#ffd700' : place === 2 ? '#c0c0c0' : place === 3 ? '#cd7f32' : 'var(--muted)';
  document.getElementById('cert-main-line').textContent = placeEmoji + ' Best AI Acumen';
  document.getElementById('winner-modal').classList.add('show');
}

function closeModal() {
  document.getElementById('winner-modal').classList.remove('show');
}

// â”€â”€ Reflection â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showReflection() {
  const s = document.getElementById('reflection-section');
  s.classList.add('show');
  s.scrollIntoView({ behavior: 'smooth' });
}


// â”€â”€ Confetti â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function launchConfetti(teamColor) {
  const colors = [teamColor, '#f5c842', '#ffffff', '#00bceb', teamColor];
  for (let i = 0; i < 110; i++) {
    const p = document.createElement('div');
    p.className = 'confetti-piece';
    p.style.left   = Math.random() * 100 + 'vw';
    p.style.width  = (Math.random() * 8 + 4) + 'px';
    p.style.height = (Math.random() * 8 + 4) + 'px';
    p.style.background = colors[Math.floor(Math.random() * colors.length)];
    p.style.borderRadius = Math.random() > 0.5 ? '50%' : '2px';
    p.style.animationDuration = (Math.random() * 2 + 2) + 's';
    p.style.animationDelay   = (Math.random() * 1.5) + 's';
    document.body.appendChild(p);
    setTimeout(function() { p.remove(); }, 5000);
  }
}

// â”€â”€ Utils â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function hexAlpha(hex, alpha) {
  const r = parseInt(hex.slice(1,3),16);
  const g = parseInt(hex.slice(3,5),16);
  const b = parseInt(hex.slice(5,7),16);
  return 'rgba(' + r + ',' + g + ',' + b + ',' + alpha + ')';
}

function escHtml(str) {
  return str.replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

// â”€â”€ Rename overlay â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var renameMode = false;

function openRenameOverlay() {
  var myId = getMyTeamId();
  var myTeam = teams.find(function(t) { return t.id === myId; });
  if (!myTeam) return;
  renameMode = true;
  document.getElementById('overlay-title').textContent = 'Rename your team';
  document.getElementById('overlay-subtitle').textContent = 'Enter a new name for your team.';
  document.getElementById('join-game-btn').textContent = 'Save';
  var input = document.getElementById('team-name-input');
  input.value = myTeam.name || '';
  document.getElementById('name-entry-overlay').classList.remove('hidden');
  input.focus();
  input.select();
}

function handleOverlaySubmit() {
  var input = document.getElementById('team-name-input');
  var name = (input.value || '').trim();
  if (!name) { alert('Please enter a team name'); return; }

  if (renameMode) {
    var myId = getMyTeamId();
    if (myId) setTeamName(myId, name);
    document.getElementById('name-entry-overlay').classList.add('hidden');
    renameMode = false;
  } else {
    setPlayerId(generateUuid());
    setInitialTeamName(name);
    document.getElementById('name-entry-overlay').classList.add('hidden');
    initMultiplayer();
  }
}

// â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function startApp() {
  if (getPlayerId()) {
    document.getElementById('name-entry-overlay').classList.add('hidden');
    initMultiplayer();
  } else {
    document.getElementById('overlay-title').textContent = 'Name your team';
    document.getElementById('overlay-subtitle').textContent = 'Choose a team name. You control your team\'s board and everyone can see your progress.';
    document.getElementById('join-game-btn').textContent = 'Join game';
  }
  var btn = document.getElementById('join-game-btn');
  var input = document.getElementById('team-name-input');
  if (btn && input) {
    btn.addEventListener('click', handleOverlaySubmit);
    input.addEventListener('keydown', function(e) { if (e.key === 'Enter') btn.click(); });
  }
})();

async function initMultiplayer() {
  if (window.location.protocol === 'file:') {
    alert('Multiplayer requires a web server (not file://).\n\nQuick option: run python3 -m http.server\nThen open http://localhost:8000');
  }

  gameId = getGameIdFromUrl();
  var isNewRoom = false;
  if (!gameId) {
    gameId = generateGameId();
    setGameIdInUrl(gameId);
    isNewRoom = true;
  }

  showRoomUI(gameId);

  const { gameRef, teamsRef } = getRefs(gameId);

  const gameSnap = await getDoc(gameRef);
  if (!gameSnap.exists()) {
    await setDoc(gameRef, { createdAt: Date.now(), status: 'active' });
  }

  if (isNewRoom) {
    setTimeout(function() {
      alert('Room created: ' + gameId + '\n\nShare this link so others join the same game:\n' + window.location.href);
    }, 50);
  }

  if (unsubTeams) unsubTeams();
  unsubTeams = onSnapshot(teamsRef, async function(snap) {
    var nextTeams = [];
    snap.forEach(function(d) {
      var data = d.data() || {};
      nextTeams.push({
        id: d.id,
        name: data.name || '',
        color: data.color || '#049fd9',
        ownerId: data.ownerId || null,
        marked: new Set(Array.isArray(data.marked) ? data.marked : [FREE_INDEX]),
        bingos: Number.isFinite(data.bingos) ? data.bingos : 0,
        claimedLines: new Set(Array.isArray(data.claimedLines) ? data.claimedLines : []),
        lastBingoAt: Number.isFinite(data.lastBingoAt) ? data.lastBingoAt : 0,
        lastBingoKey: data.lastBingoKey || '',
        firstBingoAt: Number.isFinite(data.firstBingoAt) ? data.firstBingoAt : 0
      });
    });

    teams = nextTeams;

    var playerId = getPlayerId();
    var hasMyTeam = playerId && teams.some(function(t) { return t.ownerId === playerId; });
    if (!hasMyTeam && playerId) {
      if (ensuringDefaultTeam) return;
      ensuringDefaultTeam = true;
      try {
        await addTeam(getInitialTeamName());
      } finally {
        ensuringDefaultTeam = false;
      }
      return;
    }

    var myId = getMyTeamId();
    if (!activeTeamId) activeTeamId = myId || (teams[0] ? teams[0].id : null);
    if (activeTeamId && !teams.some(function(t) { return t.id === activeTeamId; })) activeTeamId = myId || (teams[0] ? teams[0].id : null);

    totalBingos = teams.reduce(function(sum, t) { return sum + (t.bingos || 0); }, 0);

    renderTeamInputs();
    renderTeamTabs();
    renderBoard();
    updateUI();

    teams.forEach(function(t) {
      var prev = lastBingoAtByTeam.get(t.id) || 0;
      if (t.lastBingoAt && t.lastBingoAt > prev && t.lastBingoAt >= clientStartedAt) {
        animateBingoLine(t.lastBingoKey);
        if (isMyTeam(t.id)) showWinner(t);
      }
      lastBingoAtByTeam.set(t.id, t.lastBingoAt || 0);
    });
  });
}

async function copyGameLink() {
  var link = window.location.href;
  try {
    await navigator.clipboard.writeText(link);
    var btn = document.getElementById('copy-link-btn');
    if (btn) {
      var prev = btn.textContent;
      btn.textContent = 'Copied!';
      setTimeout(function() { btn.textContent = prev; }, 900);
    }
  } catch(e) {
    prompt('Copy this link:', link);
  }
}

// Expose to inline handlers
window.setTeamName = setTeamName;
window.removeTeam = removeTeam;
window.showReflection = showReflection;
window.closeModal = closeModal;
window.copyGameLink = copyGameLink;
window.openRenameOverlay = openRenameOverlay;
</script>
</body>
</html>
